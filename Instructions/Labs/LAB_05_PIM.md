---
lab:
    title: '05 - Azure AD Privileged Identity Management'
    module: 'モジュール 01 - ID とアクセスの管理'
---

# 課題 05: Azure AD Privileged Identity Management
# 受講生用ラボ マニュアル

## ラボのシナリオ

Azure Privileged Identity Management (PIM) を使用してジャストインタイム管理を有効にし、特権操作を実行できるユーザー数を制御する概念実証を作成するように求められました。具体的な要件は次のとおりです。

- aaduser2 Azure AD ユーザーのセキュリティ管理者の役割への永続的な割り当てを作成します。 
- aaduser2 Azure AD ユーザーが課金管理者の役割とグローバル閲覧者の役割の対象となるように構成します。
- Aaduser3 Azure AD ユーザーの承認を要求するようにグローバル閲覧者の役割のアクティブ化を構成します。
- グローバル閲覧者の役割のアクセス レビューを構成し、監査機能を確認します。

> このラボのすべてのリソースについて、**米国東部** リージョンを使用しています。クラスに使用する地域であることを講師に確認します。 

> 先に進む前に、課題 04 を完了していることを確認してください。MFA、条件付きアクセス、および AAD ID 保護Azure AD テナント、AdatumLab500-04、および aaduser1、aaduser2、および aaduser3 ユーザー アカウントが必要です。

## ラボの目的

このラボでは、次の演習を行います:

- 演習 1: PIM ユーザーとロールを構成します。
- 演習 2: 承認の有無にかかわらず、PIM ロールをアクティブ化します。
- 演習 3: アクセス レビューを作成し、PIM 監査機能を確認します。

### 演習 1 : PIM ユーザーとロールの設定

#### 予想時間: 15 分

この演習では、次のタスクを行います。

- タスク 1: ユーザーをロールの対象にします。
- タスク 2: 対象メンバーをアクティブ化して追加する承認を要求するようにロールを構成します。
- タスク 3: ユーザーに永続的なロールを割り当てます。 

#### タスク 1: ユーザーをロールの対象にします

このタスクでは、ユーザーに Azure AD ディレクトリ ロールの資格を与えます。

1. Azure portal **`https://portal.azure.com/`** にサインインします。

    >**注意**: **AdatumLab500-04** Azure AD テナントにサインインしていることを確認します。**ディレクトリ + サブスクリプション** フィルターを使用して、Azure AD テナント間で切り替えることができます。グローバル管理者ロールを持つユーザーとしてサインインしていることを確認します。
    
    >**注**: それでも AdatumLab500-04 エントリが表示されない場合は、[ディレクトリの切り替え] リンクをクリックし、AdatumLab500-04 行を選択して、[切り替え] ボタンをクリックします。

1. Azure portal で、Azure portal ページの上部にある 「**リソース、サービス、ドキュメントの検索**」 テキスト ボックスで 「**Azure AD Privileged Identity Management**」 と入力し、**Enter** キーを押します。

1. 「**Azure AD Privileged Identity Management**」 ブレードの 「**管理**」 セクションで、「**Azure AD ロール**」 をクリックします。

1. 「**AdatumLab500-04 \| クイック スタート**」 ブレードの 「**管理**」 セクションで 、「**ロール**」 をクリックします。

1. 「**AdatumLab500-04 \| ロール**」 ブレードで、「**+ 割り当ての追加**」 をクリックします。

1. 「**割り当ての追加**」 ブレードの 「**ロールの選択**」 ドロップダウンで、「**課金管理者**」 を選択します。

1. 「**メンバーが選択されていない**」 リンクをクリックし、「**メンバーの選択**」 ブレードで 「**aaduser2**」 をクリックし、「**選択**」 をクリックします。

1. 「**割り当ての追加**」 ブレードに戻り 、「**次へ**」 をクリックします。 

1. 「**割り当ての種類**」 が 「**対象**」 に設定されていることを確認し、「**割り当て**」 をクリック します。
 
1. **AdatumLab500-04** **\|** **ロール** ブレードの 「**管理**」 セクションで 、「**割り当て**」 をクリックします。

1. **AdatumLab500-04 \| 割り当て** ブレードで、「**資格のある割り当て**」、「**アクティブな割り当て**」、「**期限切れの割り当て**」 の各タブを確認します。

1. 「**資格のある割り当て**」 タブで、**aaduser2** が **課金管理者** として表示されていることを確認します。 

    >**注意**: サインイン時に、aaduser2 は課金管理者ロールを使用する資格があります。 

#### タスク 2: 対象メンバーをアクティブ化して追加する承認を要求するようにロールを構成する

1. Azure Portal で、「**Azure AD Privileged Identity Management**」 ブレードに戻り 、「**Azure AD ロール**」 をクリックします。

1. 「**AdatumLab500-04** **\|** **クイック スタート**」 ブレードの 「**管理**」 セクションで 、「**ロール**」 をクリックします。

1. 「**AdatumLab500-04** **\|** **ロール**」 ブレードで、「**グローバル閲覧者**」 のロール エントリをクリックします。 

1. 「**グローバル閲覧者** **\|** **割り当て**」 ブレードで、ブレードのツール バーにある 「**設定**」 アイコンをクリックし、Azure Multi-Factor Authentication 要件を含むロールの構成設定を確認します。

1. **「編集」** をクリックします。

1. 「**アクティブ化**」 タブで、「**アクティブにするには承認が必要です**」 チェック ボックスをオンにします。

1. 「**メンバーの選択**」 ブレードで、「**承認者の選択**」 をクリックし、「**aaduser3**」 をクリックした後、「**選択**」 をクリックします。

1. 「**次へ: 割り当て**」 をクリックします。

1. 「**永続的な資格のある割り当てを許可する**」 チェック ボックスをオフにし、その他のすべての設定は既定値のままにします。

1. 「**次へ: 通知**」 をクリックします。

1. 「**ロール設定の編集 - グローバル閲覧者**」 ブレードで設定を確認し、「**更新**」 をクリックします。

    >**注意**: グローバル閲覧者ロールを使用しようとする人は、aaduser3 の承認が必要になります。 

1. 「**グローバル閲覧者** **\|** **割り当て**」 ブレードで、「**+ 割り当ての追加**」 をクリックします。

1. 「**割り当ての追加**」 ブレードで、「**メンバーが選択されていない**」 をクリックし、「**メンバーの選択**」 ブレードで 「**aaduser2**」 をクリックしてから、「**選択**」をクリックします。

1. 「**次へ**」 をクリックします。 

1. **割り当ての種類** が **「対象」** であることを確認し、対象期間の設定を確認します。

1. 「**割り当て**」 をクリックします。

    >**注意**: ユーザー aaduser2 はグローバル閲覧者ロールの対象となります。 
 
#### タスク 3: ユーザーに永続的なロールを割り当てます。

1. Azure Portal で、「**Azure AD Privileged Identity Management**」 ブレードに戻り 、「**Azure AD ロール**」 をクリックします。

1. 「**AdatumLab500-04** **\|** **クイック スタート**」 ブレードの 「**管理**」 セクションで 、「**ロール**」 をクリックします。

1. 「**AdatumLab500-04** **\|** **ロール**」 ブレードで、「**+ 割り当ての追加**」 をクリックします。

1. 「**割り当ての追加**」 ブレードの 「**ロールの選択**」 ドロップダウンで 、「**セキュリティ管理者**」 を選択します。

1. 「**割り当ての追加**」 ブレードで、 「**メンバーが選択されていない**」 をクリックし、「**メンバーの選択**」 ブレードで 「**aaduser2**」 をクリックして、「**選択**」 をクリックします。

1. 「**次へ**」 をクリックします。 

1. 「**割り当ての種類**」の設定を確認し、「**割り当て**」をクリックします。

    >**注**: これで、ユーザー aaduser2 は、永久的にセキュリティ管理者ロールの資格を持つようになりました。
	
### 演習 2 - 承認の有無にかかわらず PIM ロールをアクティブ化する

#### 予想時間: 15 分

この演習では、次のタスクを行います。

- タスク 1: 承認を必要としないロールをアクティブ化します。 
- タスク 2: 承認が必要なロールをアクティブ化します。 

#### タスク 1: 承認を必要としないロールをアクティブ化します。

このタスクでは、承認を必要としないロールをアクティブ化します。

1. InPrivate ブラウザーの画面を開きます。

1. InPrivate ブラウザー画面で、Azure portal に移動し、**aaduser2** ユーザー アカウントを使用してサインインします。

    >**注意**: サインインするには、このラボで前に記録した Azure AD テナントの DNS ドメイン名を含む、**aaduser2** ユーザー アカウントの完全修飾名を指定する必要があります。このユーザー名の形式は、aaduser2 @ `<your_tenant_name>` .onmicrosoft.com です。ここで、 `<your_tenant_name>` は一意の Azure AD テナント名を表すプレースホルダーです。 

1. Azure portal で、Azure portal ページの上部にある 「**リソース、サービス、ドキュメントの検索**」 テキスト ボックスで 「**Azure AD Privileged Identity Management**」 と入力し、**Enter** キーを押します。

1. 「**Azure AD Privileged Identity Management**」 ブレードの 「**タスク**」 セクションで、 「**自分のロール**」 をクリックします。

1. **aaduser2** の 3 つの**資格のあるロール**が表示されます。**資格のある割り当て** タブに **グローバル閲覧者**、**課金管理者** および **セキュリティ管理者**。

1. **資格のある割り当て** タブの **課金管理者** ロール エントリが表示されている行で 、「**アクティブ化**」 をクリックします。

1. 必要な場合は、警告 「**追加検証が必要です。クリックして続行します**」 をクリックします。指示に従って、本人確認を行います。

1. 「**アクティブ化 - 課金管理者**」 ブレードの 「**理由**」 テキスト ボックスに 、アクティブ化の理由を示すテキストを入力し、「**アクティブ化**」 をクリックします。

    >**注意**: PIM でロールをアクティブ化する場合、有効化が有効となるまでに最大 10 分かかることがあります。 
	
    >**注**: ロールの割り当てがアクティブになると、ブラウザーが更新されます (問題が発生した場合は、サインアウトして、**aaduser2** ユーザー アカウントを使用して Azure portal に再度サインインします)。

1. 「**Azure AD Privileged Identity Management**」 ブレードに戻り、「**タスク**」 セクションで 「**自分のロール**」 をクリック します。

1. 「**自分のロール** **\|** **Azure AD ロール**」 ブレードで、「**アクティブな割り当て**」 タブに切り替えます。「**課金管理者**」 ロールが 「**アクティブ化済み**」 になっていることに注目してください。

    >**注意**: ロールがアクティブ化されると、**終了時刻** の制限時間に達した時点で、自動的に非アクティブ化されます。

    >**注意**: 管理者のタスクを早期に完了した場合、ロールを手動で非アクティブ化することもできます。

1.  **アクティブなロール**のリストで、課金管理者割り当てを表す行で、「**非アクティブ化**」 リンクをクリックします。

1.  「**非アクティブ化 - 課金管理者**」ブレードで、再度「**非アクティブ化**」をクリックして確定します。


#### タスク 2: 承認が必要なロールをアクティブ化します。 

このタスクでは、承認が必要なロールをアクティブ化します。

1. InPrivate ブラウザー画面での Azure portal で、**aaduser2** ユーザーとしてサインインしている間に、**Privileged Identity Management** **\|** **クイック スタート** ブレードに戻ります。  

1. **Privileged Identity Management \| クイック スタート**」ブレードの「**管理**」セクションで 、「**自分のロール**」をクリックします。

1. 「**自分のロール** **\|** **Azure AD ロール**」 ブレードの 「**資格のある割り当て**」タブの「**グローバル閲覧者**」ロール エントリが表示されている行で、「**アクティブ化**」 をクリック します。 

1. 「**アクティブ化 - グローバル閲覧者**」 ブレードの 「**理由**」 テキスト ボックスに 、アクティブ化の理由を示すテキストを入力し、「**アクティブ化**」 をクリックします。

1. Azure portal ツール バーの 「**通知**」 アイコンをクリックし、要求が承認待ちであることを知らせる通知を表示します。

    >**注意**: 特権ロール管理者として、いつでも要求を確認および取り消すことができます。 

1. 「**自分のロール** \| **Azure AD ロール**」 ブレードで、**セキュリティ管理者**のロールを見つけて、「**アクティブ化**」 をクリックします。 

1. 警告 「**追加検証が必要です。クリックして続行します**」 をクリックします。 

1. 指示に従って、本人確認を行います。

    >**注意**: セッションごとに 1 回だけ認証する必要があります。 

1. Azure portal インターフェイスに戻ったら、「**アクティブ化 - セキュリティ管理者**」 ブレードの 「**理由**」 テキスト ボックスに、アクティブ化の理由を示すテキストを入力し、「**アクティブ化**」 をクリックします。

    >**注意**: 自動承認プロセスが完了するはずです。

1. 「**自分のロール** \| **Azure AD ロール**」 ブレードで、「**アクティブな割り当て**」 タブをクリックすると、**アクティブな割り当て** の一覧には **セキュリティ管理者** が含まれますが、**グローバル閲覧者** ロールは含まれていないことがわかります。

    >**注意**: これでグローバル閲覧者ロールを承認します。

1. Azure portal から **aaduser2** としてサインアウトします。

1. **aaduser3** としてAzure portal にサインインします。

    >**注意**: いずれかのユーザー アカウントを使用した認証で問題が発生した場合は、自身のユーザー アカウントを使用してAzure AD テナントにサインインし、パスワードをリセットするか、サインイン オプションを再構成できます。

1. Azure portal で、**Azure AD Privileged Identity Management** に移動します。

1. 「**Privileged Identity Management** **\|** **クイック スタート**」 ブレードの 「**タスク**」 セクションで 、「**申請の承認**」 をクリックします。

1. 「**申請の承認** \| **Azure AD ロール**」 ブレードの 「**ロールのアクティブ化に関する要求**」 セクションで 、**aaduser2** による **グローバル閲覧者** ロールへのロールのアクティブ化要求を表すエントリのチェックボックスを選択します。

1. 「**承認**」 をクリックします。「**要求の承認**」 ブレードの 「**理由**」 テキストボックスに、有効化の理由を入力し、開始時刻と終了時刻をメモして、「**確認**」 をクリックします。 

    >**注意**: リクエストを拒否することもできます。

1. Azure portal から **aaduser3** としてサインアウトします。

1. Azure portal に **aaduser2** としてサインインします。

1. Azure portal で、**Azure AD Privileged Identity Management** に移動します。

1. 「**Privileged Identity Management** **\|** **クイック スタート**」 ブレードの 「**タスク**」 セクションで 、「**自分のロール**」 をクリックします。

1. 「**自分のロール** \| **Azure AD ロール**」 ブレードで、「**アクティブな割り当て**」 タブをクリックし、**グローバル閲覧者** ロールがアクティブになっていることを確認します。

    >**注意**: 更新されたアクティブな割り当ての一覧を表示するには、ページを更新する必要がある場合があります。

1. サインアウトし、InPrivate ブラウザーの画面を閉じます。

> 結果: 承認有りと無しで、PIM ロールの有効化を練習しました。 

### 演習 3 - アクセス レビューを作成し、PIM 監査機能を確認する

#### 予想時間: 10 分

この演習では、次のタスクを行います。

- タスク 1: PIM で Azure AD ディレクトリ ロールのセキュリティ アラートを構成する
- タスク 2: PIM アラート、サマリ情報、詳細な監査情報の確認

#### タスク 1: PIM で Azure AD ディレクトリ ロールのセキュリティ アラートを構成する

このタスクでは、"古くなった" ロールの割り当てに関連するリスクを軽減します。この作業を行うには、PIM アクセス レビューを作成して、割り当てられたロールが有効であることを確認します。具体的には、グローバル閲覧者ロールを確認します。 

1. 自信のアカウントから Azure portal **`https://portal.azure.com/`** にサインインします。

    >**注意**: **AdatumLab500-04** Azure AD テナントにサインインしていることを確認します。**ディレクトリ + サブスクリプション** フィルターを使用して、Azure AD テナント間で切り替えることができます。グローバル管理者ロールを持つユーザーとしてサインインしていることを確認します。
    
    >**注**: それでも AdatumLab500-04 エントリが表示されない場合は、[ディレクトリの切り替え] リンクをクリックし、AdatumLab500-04 行を選択して、[切り替え] ボタンをクリックします。

1. Azure portal で、Azure portal ページの上部にある 「**リソース、サービス、ドキュメントの検索**」 テキスト ボックスで 「**Azure AD Privileged Identity Management**」と入力し、**Enter** キーを押します。

1. 「**Azure AD Privileged Identity Management**」 ブレードに移動します。 

1. 「**Privileged Identity Management** \| **クイック スタート**」 ブレードの 「**管理**」 セクションで 、「**Azure AD ロール**」 をクリックします。

1. 「**AdatumLab500-04** \| **クイック スタート**」 ブレードの 「**管理**」 セクションで 、「**アクセス レビュー**」 をクリックします。

1. 「**AdatumLab500-04** \| **アクセスのレビュー**」 ブレードで、「**新規**」 をクリックします。

1. 「**アクセス レビューの作成**」 ブレードで、次の設定を指定します (他の設定は既定値のままにします)。 

   |設定|値|
   |---|---|
   |レビュー名|**グローバル閲覧者のレビュー**|
   |開始日|今日の日付| 
   |頻度|**1 回**|
   |終了日|当月の終わり|
   |ロール メンバーシップの確認|**グローバル閲覧者**|
   |レビュー担当者|**選択したユーザー**|
   |レビュー担当者の選択|あなたのアカウント|

1. 「**アクセス レビューの作成**」 ブレードで、「**開始**」 をクリック します。
 
    >**注意**: レビューがデプロイされ、**AdatumLab500-04** に表示されるのに約 1 分かかります | 「**レビューにアクセス**」 ブレード。Web ページを更新する必要がある場合があります。レビューのステータスは 「**アクティブ**」 になります。 

1. 「**AdatumLab500-04** **\|** **アクセス レビュー**」 ブレードの 「**グローバル管理者レビュー**」 ヘッダーの下にある 「**グローバル閲覧者**」 エントリをクリックします。 

1. 「**グローバル閲覧者レビュー** **\|** **概要**」ページを確認し、「**進行状況**」 グラフには 「**未レビュー**」 カテゴリのユーザーが 1 人表示されていることを確認します。 

1. 「**グローバル閲覧者レビュー** 」 ブレードの 「**管理**」 セクションで、「**結果**」 をクリック します。aaduser2 は、このロールへのアクセス権を持つものとしてリストされます。

1. **aaduser2** をクリックすると、そのユーザーが関与する PIM アクティビティを表すエントリを含む詳細な監査ログが表示されます。

1. 「**AdatumLab500-04** **\|** **レビューにアクセス**」 ブレードに戻る。

1. 「**AdatumLab500-04** **\|** **レビューにアクセス**」ブレードの 「**タスク**」 セクションで 、「**アクセスのレビュー**」 をクリックし、「**グローバル 閲覧者のレビュー**」 エントリをクリックします。 

1. 「**グローバル閲覧者レビュー」** ブレードで、**aaduser2** エントリをクリックします。 

1. 「**理由」** テキスト ボックスに承認の根拠を入力し、「**承認**」 をクリックして現在のロール メンバーシップを維持するか、「**拒否**」 をクリック して、承認を取り消します。 

1. **「Azure AD Privileged Identity Management」** ブレードに戻り、「**管理**」 セクションで 「**Azure AD ロール**」 をクリック します。

1. 「**AdatumLab500-04** **\|** **クイック スタート**」 ブレードの 「**管理**」 セクションで 、「**アクセス レビュー**」 をクリックします。

1. **グローバル閲覧者**レビューを表すエントリを選択します。**進捗状況**グラフが更新され、レビューが表示されたことを確認します。 

#### タスク 2: PIM アラート、サマリ情報、および詳細な監査情報を確認します。 

このタスクでは、PIM アラート、サマリー情報、および詳細な監査情報を確認します。 

1. **「Azure AD Privileged Identity Management」** ブレードに戻り、「**管理**」 セクションで 「**Azure AD ロール**」 をクリック します。

1. 「**AdatumLab500-04 \| クイック スタート**」 ブレードの 「**管理**」 セクションで 、「**警告**」 をクリックし、「**設定**」 をクリック します。

1. 「**アラートの設定**」 ブレードで、構成済みのアラートとリスク レベルを確認します。詳細については、いずれかをクリックしてください。 

1. **AdatumLab500-04 \| クイック スタート**」 ブレードに戻り、「**概要**」 をクリックします。 

1. **AdatumLab500-04 \| 概要**ブレード、ロールのアクティブ化、PIM アクティビティ、アラート、およびロール割り当てに関するサマリ情報を確認します。

1. 「**AdatumLab500-04 \| 概要**」 ブレードの 「**アクティビティ**」 セクションで 、「**リソースの監査**」 をクリックします。 

    >**注意**: 監査履歴は、過去 30 日以内にすべての特権ロールの割り当てとアクティブ化に使用できます。

1. **時間**、**リクエスター**、**アクション**、**リソース名**、**スコープ**、**プライマリ ターゲット**、**件名**などの詳細情報を取得できることに注意してください。 

> 結果: アクセス レビューを構成し、監査情報を確認しました。 

**リソースをクリーン アップします**

> Azure リソースのうち、使用しないリソースは必ず削除してください。使用していないリソースを削除することで、予期しないコストが発生しなくなります。 

1. Azure portal で、**ディレクトリ + サブスクリプション** フィルターを、**az500-04-vm1** Azure VM をデプロイした Azure サブスクリプションに関連付けられている Azure AD テナントに設定します。

>**注**: メインの Azure AD テナント エントリが表示されない場合は、「ディレクトリの切り替え」リンクをクリックし、メインのテナントの行を選択して、「切り替え」ボタンをクリックします。

1. Azure portal から、Azure portal の右上にあるアイコンをクリックして、 Cloud Shell を開きます。メッセージが表示されたら、「**PowerShell**」 と 「**ストレージの作成**」 をクリックします。

1. 「Cloud Shell」 ウィンドウの左上隅にあるドロップダウン メニューで 「**PowerShell**」 が選択されていることを確認します。

1. 「クラウド シェル」 ウィンドウ内の 「PowerShell」 セッションで、次の手順を実行して、このラボで作成したリソース グループを削除します。
  
    ```powershell
    Remove-AzResourceGroup -Name "AZ500LAB04" -Force -AsJob
    ```

1.  **「Cloud Shell」** ウィンドウを閉じます。 

1. Azure portal に戻り、**ディレクトリ + サブスクリプション** フィルターを使用して **AdatumLab500-04** Azure Active Directory テナントに切り替えます。

1. 「**Azure Active Directory Premium P2 - ライセンスユーザー**」ブレードに移動し、ライセンスを割り当てたユーザー アカウントを選択します。「**ライセンスの削除**」をクリックし、確認を求められたら、「**はい**」を選択します。

1. Azure portal で、**ユーザー-すべてのユーザー**ブレードに移動し、**aaduser1** ユーザー アカウントを表すエントリをクリックします。「**aaduser1 - プロファイル**」 ブレードで 「**削除**」 をクリックし、確認を求められたら、「**はい**」 を選択します。

1. 同じ手順を繰り返して、作成した残りのユーザー アカウントを削除します。

1. 「**Azure AD テナントの AdatumLab500-04 - 概要**」 ブレードに移動し、「**テナントの削除**」 をクリックして、「**'ディレクトリ 'AdatumLab500-04' の削除**」 ブレードで **、「Azure リソースを削除するアクセス許可を取得する」** リンクをクリック し、Azure Active Directory の 「**プロパティ**」 ブレードで **「Azure リソースのアクセス管理」** を **「はい」** に設定 し、「**保存**」 をクリックします 。

1. Azure portal からサインアウトし、サインインし直します。 

1. 「**ディレクトリ 'AdatumLab500-04' の削除**」 ブレードに戻り、「**削除**」 をクリックします。

> このタスクに関する追加情報については、[https://docs.microsoft.com/ja-jp/azure/active-directory/users-groups-roles/directory-delete-howto](https://docs.microsoft.com/ja-jp/azure/active-directory/users-groups-roles/directory-delete-howto) を参照してください。
